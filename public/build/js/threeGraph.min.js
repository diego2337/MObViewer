function displayGraphInfo(jason){void 0!==jason.graphInfo[0].vlayer?document.getElementById("numberOfVertices").innerHTML=parseInt(jason.graphInfo[0].vlayer.split(" ")[0])+parseInt(jason.graphInfo[0].vlayer.split(" ")[1]):document.getElementById("numberOfVertices").innerHTML=parseInt(jason.graphInfo[0].vertices.split(" ")[0])+parseInt(jason.graphInfo[0].vertices.split(" ")[1]),document.getElementById("numberOfEdges").innerHTML=parseInt(jason.graphInfo[0].edges),void 0!==jason.graphInfo[0].vlayer?document.getElementById("nVerticesFirstLayer").innerHTML=parseInt(jason.graphInfo[0].vlayer.split(" ")[0]):document.getElementById("nVerticesFirstLayer").innerHTML=parseInt(jason.graphInfo[0].vertices.split(" ")[0]),void 0!==jason.graphInfo[0].vlayer?document.getElementById("nVerticesSecondLayer").innerHTML=parseInt(jason.graphInfo[0].vlayer.split(" ")[1]):document.getElementById("nVerticesSecondLayer").innerHTML=parseInt(jason.graphInfo[0].vertices.split(" ")[1])}function disposeNode(node){node instanceof THREE.Mesh&&(node.geometry&&(node.geometry.dispose(),node.geometry=null),node.material&&(node.material instanceof THREE.MeshFaceMaterial?$.each(node.material.materials,function(idx,mtrl){mtrl.map&&(mtrl.map.dispose(),mtrl.map=null),mtrl.lightMap&&(mtrl.lightMap.dispose(),mtrl.lightMap=null),mtrl.bumpMap&&(mtrl.bumpMap.dispose(),mtrl.bumpMap=null),mtrl.normalMap&&(mtrl.normalMap.dispose(),mtrl.normalMap=null),mtrl.specularMap&&(mtrl.specularMap.dispose(),mtrl.specularMap=null),mtrl.envMap&&(mtrl.envMap.dispose(),mtrl.envMap=null),mtrl.dispose(),mtrl=null}):(node.material.map&&(node.material.map.dispose(),node.material.map=null),node.material.lightMap&&(node.material.lightMap.dispose(),node.material.lightMap=null),node.material.bumpMap&&(node.material.bumpMap.dispose(),node.material.bumpMap=null),node.material.normalMap&&(node.material.normalMap.dispose(),node.material.normalMap=null),node.material.specularMap&&(node.material.specularMap.dispose(),node.material.specularMap=null),node.material.envMap&&(node.material.envMap.dispose(),node.material.envMap=null),node.material.dispose(),node.material=null)),node=null)}function disposeHierarchy(node,callback){for(var i=node.children.length-1;i>=0;i--){var child=node.children[i];disposeHierarchy(child,callback),callback(child)}}function build(data,layout,min,max){function animate(){if(renderer.render(scene,camera),requestAnimationFrame(animate),capture){capture=!1;var dataURL=document.getElementsByTagName("canvas")[0].toDataURL("image/png"),wd=window.open("about:blank","graph");wd.document.write("<img src='"+dataURL+"' alt='from canvas'/>"),wd.document.close()}}min=ecmaStandard(min,10),max=ecmaStandard(max,70),lay=ecmaStandard(layout,2);var jason=JSON.parse(data);if(displayGraphInfo(jason),void 0!==bipartiteGraph&&delete bipartiteGraph,bipartiteGraph=new BipartiteGraph(jason,min,max),void 0==renderer?(canvasWidth=document.getElementById("mainSection").clientWidth,canvasHeight=document.getElementById("mainSection").clientHeight,(renderer=new THREE.WebGLRenderer({antialias:!0})).setClearColor("rgb(255, 255, 255)",1),renderer.setSize(canvasWidth,canvasHeight)):(renderer.setRenderTarget(null),renderer.clear()),void 0!==scene){disposeHierarchy(scene,disposeNode);for(var i=scene.children.length-1;i>=0;i--)scene.remove(scene.children[i]);delete scene}else scene=new THREE.Scene;document.getElementById("WebGL").appendChild(renderer.domElement),bipartiteGraph.buildGraph(jason,scene,lay),void 0!==gradientLegend&&(gradientLegend.clear(),delete gradientLegend),(gradientLegend=new GradientLegend(bipartiteGraph.linearScale,bipartiteGraph.graphInfo.minEdgeWeight,bipartiteGraph.graphInfo.maxEdgeWeight,300,50,5)).createGradientLegend("gradientScale","Edge weights:"),delete jason,void 0!==camera&&delete camera,(camera=new THREE.PerspectiveCamera(120,canvasWidth/canvasHeight,1,2e3)).position.set(0,0,cameraPos),camera.lookAt(scene.position),camera.name="camera",scene.add(camera),void 0!==light&&delete light,(light=new THREE.DirectionalLight).position.set(0,0,10),scene.add(light),void 0!==controls&&delete controls;var controls=new THREE.OrbitControls(camera,renderer.domElement);controls.minDistance=1,controls.maxDistance=500,controls.zoomSpeed=1.5,controls.target.set(0,0,0),controls.enableRotate=!1,controls.enableKeys=!1,controls.mouseButtons={PAN:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,ORBIT:THREE.MOUSE.RIGHT},void 0===eventHandler&&(eventHandler=new EventHandler(void 0),document.addEventListener("resize",function(evt){camera.aspect=document.getElementById("WebGL").clientWidth/document.getElementById("WebGL").clientHeight,camera.updateProjectionMatrix(),renderer.setSize(document.getElementById("WebGL").clientWidth,document.getElementById("WebGL").clientHeight)},!1),document.addEventListener("mousemove",function(evt){eventHandler.mouseMoveEvent(evt,renderer,scene)},!1),document.addEventListener("dblclick",function(evt){eventHandler.mouseDoubleClickEvent()},!1),document.addEventListener("click",function(evt){eventHandler.mouseClickEvent(evt,renderer,scene)},!1)),animate()}var BipartiteGraph=function(graph,min,max){try{this.graphInfo=graph.graphInfo[0],void 0!=this.graphInfo.vlayer?(this.firstLayer=this.graphInfo.vlayer.split(" "),this.firstLayer=this.firstLayer[0],this.lastLayer=this.graphInfo.vlayer.split(" "),this.lastLayer=this.lastLayer[this.lastLayer.length-1]):void 0!=this.graphInfo.vertices?(this.firstLayer=this.graphInfo.vertices.split(" "),this.firstLayer=this.firstLayer[0],this.lastLayer=this.graphInfo.vertices.split(" "),this.lastLayer=this.lastLayer[this.lastLayer.length-1]):this.firstLayer=this.lastLayer=Math.floor(graph.nodes.length/2),this.graphInfo.min=ecmaStandard(min,0),this.graphInfo.max=ecmaStandard(max,10),this.graphSize=parseInt(this.firstLayer)+parseInt(this.lastLayer),this.distanceBetweenSets=8,this.minEdgeWeight=1,this.maxEdgeWeight=5,this.linearScale=void 0}catch(err){throw"Unexpected error ocurred at line "+err.lineNumber+", in function BipartiteGraph. "+err}};BipartiteGraph.prototype.getNodes=function(){return this.nodes},BipartiteGraph.prototype.getNodeByIndex=function(i){return-1!=i?this.nodes[i]:"Node not found."},BipartiteGraph.prototype.getTotalNumberOfNodes=function(){return this.nodes.length},BipartiteGraph.prototype.getNumberOfNodesFromFirstLayer=function(){return this.firstLayer.length},BipartiteGraph.prototype.getNumberOfNodesFromSecondLayer=function(){return this.lastLayer.length},BipartiteGraph.prototype.getEdgeByIndex=function(i){return-1!=i?this.edges[i]:"Edge not found."},BipartiteGraph.prototype.getNumberOfEdges=function(){return this.edges.length},BipartiteGraph.prototype.findNeighbors=function(graph,i){var neighbors=[];for(neighbors.push(parseInt(graph.nodes[i].id)),j=0;j<graph.links.length;j++)parseInt(graph.links[j].source)==parseInt(graph.nodes[i].id)?neighbors.push(parseInt(graph.links[j].target)):parseInt(graph.links[j].target)==parseInt(graph.nodes[i].id)&&neighbors.push(parseInt(graph.links[j].source));return neighbors},BipartiteGraph.prototype.writeProperties=function(singleGeometry,jsonObject,i){for(var property in jsonObject)"vertexes"!=property&&jsonObject.hasOwnProperty(property)&&(void 0===singleGeometry.faces[i].properties?singleGeometry.faces[i].properties="":singleGeometry.faces[i].properties=singleGeometry.faces[i].properties+";",singleGeometry.faces[i].properties=singleGeometry.faces[i].properties+property+":"+jsonObject[property])},BipartiteGraph.prototype.buildGraph=function(graph,scene,layout){layout=ecmaStandard(layout,2),scene=ecmaStandard(scene,void 0);try{for(var y=-document.getElementById("mainSection").clientHeight/this.distanceBetweenSets,positions=[],material=new THREE.MeshLambertMaterial({wireframe:!1,vertexColors:THREE.FaceColors}),circleGeometry=new THREE.CircleGeometry(1,32),k=0;k<circleGeometry.faces.length;k++)circleGeometry.faces[k].color.setRGB(0,0,0);for(var singleGeometry=new THREE.Geometry,i=0,pos=this.firstLayer/2*-1;i<graph.nodes.length;i++,pos++){i==this.firstLayer&&(pos=-1*Math.floor(this.lastLayer/2),y*=-1);var x=5*pos;void 0==graph.nodes[i].weight&&(graph.nodes[i].weight=parseInt(graph.graphInfo[0].minNodeWeight));var circleSize=(parseInt(graph.nodes[i].weight)-parseInt(graph.graphInfo[0].minNodeWeight))/(parseInt(graph.graphInfo[0].maxNodeWeight)-parseInt(graph.graphInfo[0].minNodeWeight)+1)*4+1;0==circleSize&&(circleSize=parseInt(graph.graphInfo[0].minNodeWeight)),circleGeometry.scale(circleSize,circleSize,1),circleGeometry.name=graph.nodes[i].id,3==layout?(circleGeometry.translate(y,x,0),positions.push({x:y,y:x,z:0}),singleGeometry.merge(circleGeometry),circleGeometry.translate(-y,-x,0)):(circleGeometry.translate(x,y,0),positions.push({x:x,y:y,z:0}),singleGeometry.merge(circleGeometry),circleGeometry.translate(-x,-y,0),circleGeometry.arrayOfProperties=[]),circleGeometry.name="",circleGeometry.scale(1/circleSize,1/circleSize,1)}for(var i=0,j=0;i<singleGeometry.faces.length&&j<graph.nodes.length;i+=32,j++)singleGeometry.faces[i].properties=JSON.stringify(graph.nodes[j]),singleGeometry.faces[i].neighbors=this.findNeighbors(graph,j),singleGeometry.faces[i].position=positions[j];if(mesh=new THREE.Mesh(singleGeometry,material),mesh.name="MainMesh",mesh.renderOrder=1,scene.add(mesh),mesh=null,circleGeometry.dispose(),material.dispose(),singleGeometry.dispose(),singleGeometry=null,circleGeometry=null,material=null,graph.links){for(var edgeGeometry=new THREE.Geometry,i=0;i<graph.links.length;i++){var sourcePos=positions[graph.links[i].source],targetPos=positions[graph.links[i].target],v1=new THREE.Vector3(sourcePos.x,sourcePos.y,sourcePos.z),v2=new THREE.Vector3(targetPos.x,targetPos.y,targetPos.z);edgeGeometry.vertices.push(v1),edgeGeometry.vertices.push(v2)}for(var i=0,j=0;i<edgeGeometry.vertices.length&&j<graph.links.length;i+=2,j++){void 0==graph.links[j].weight&&(graph.links[j].weight=parseInt(graph.graphInfo[0].minEdgeWeight));var edgeSize=Math.abs((parseInt(graph.links[j].weight)-parseInt(graph.graphInfo[0].minEdgeWeight))/(parseInt(graph.graphInfo[0].maxEdgeWeight)-parseInt(graph.graphInfo[0].minEdgeWeight)+.2));0==(edgeSize=(this.maxEdgeWeight-this.minEdgeWeight)*edgeSize+this.minEdgeWeight)&&(edgeSize=parseInt(graph.graphInfo[0].minEdgeWeight)),this.linearScale=d3.scaleLinear().domain([this.minEdgeWeight,this.maxEdgeWeight]).range(["rgb(220, 255, 255)","rgb(0, 0, 255)"]),edgeGeometry.colors[i]=new THREE.Color(this.linearScale(edgeSize)),edgeGeometry.colors[i+1]=edgeGeometry.colors[i]}edgeGeometry.colorsNeedUpdate=!0;var edgeMaterial=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),lineSegments=new THREE.LineSegments(edgeGeometry,edgeMaterial,THREE.LinePieces);scene.add(lineSegments),edgeGeometry.dispose(),edgeGeometry=null,edgeMaterial.dispose(),edgeMaterial=null}}catch(err){throw"Unexpected error ocurred at line "+err.line+". "+err}};var bipartiteGraph,gradientLegend,renderer,graph,scene,camera,light,controls,eventHandler,layout=2,capture=!1,clicked={wasClicked:!1},cameraPos=document.getElementById("mainSection").clientHeight/4,vueTableHeader=new Vue({el:"#dynamicTableHeaders",data:{headers:""}}),vueTableRows=new Vue({el:"#dynamicTableRows",data:{rows:""}}),ecmaStandard=function(variable,defaultValue){return void 0!==variable?variable:defaultValue},EventHandler=function(raycaster){this.raycaster=ecmaStandard(raycaster,new THREE.Raycaster),this.raycaster.linePrecision=.1,this.highlightedElements=[],this.neighbors=[]};EventHandler.prototype.getRaycaster=function(){return this.raycaster},EventHandler.prototype.setRaycaster=function(raycaster){this.raycaster=raycaster},EventHandler.prototype.getHighlightedElements=function(){return this.highlightedElements},EventHandler.prototype.setHighlightedElements=function(highlighted){this.highlightedElements=highlighted},EventHandler.prototype.findEdgePairIndex=function(vertexArray,startEdge,endEdge){for(var i=0;i<vertexArray.length;i+=2){if(vertexArray[i].x==startEdge.x&&vertexArray[i].y==startEdge.y&&vertexArray[i].z==startEdge.z&&vertexArray[i+1].x==endEdge.x&&vertexArray[i+1].y==endEdge.y&&vertexArray[i+1].z==endEdge.z)return i;if(vertexArray[i].x==endEdge.x&&vertexArray[i].y==endEdge.y&&vertexArray[i].z==endEdge.z&&vertexArray[i+1].x==startEdge.x&&vertexArray[i+1].y==startEdge.y&&vertexArray[i+1].z==startEdge.z)return i+1}return-1},EventHandler.prototype.mouseDoubleClickEvent=function(){if(clicked.wasClicked){if(clicked.wasClicked){clicked.wasClicked=!1;for(var element=scene.getObjectByName("MainMesh",!0),lineSegments=scene.getObjectByProperty("type","LineSegments"),startEdge=element.geometry.faces[32*this.neighbors[0].vertexInfo].position,i=0;i<this.neighbors.length;i++){for(var endPoint=32*this.neighbors[i].vertexInfo+32,j=32*this.neighbors[i].vertexInfo;j<endPoint;j++)element.geometry.faces[j].color.setRGB(0,0,0);if(element.geometry.colorsNeedUpdate=!0,0!=i){var endEdge=element.geometry.faces[32*this.neighbors[i].vertexInfo].position,index=this.findEdgePairIndex(lineSegments.geometry.vertices,startEdge,endEdge);-1!=index&&lineSegments.geometry.colors[index].setRGB(this.neighbors[i].edgeColor.r,this.neighbors[i].edgeColor.g,this.neighbors[i].edgeColor.b),lineSegments.geometry.colorsNeedUpdate=!0}}this.neighbors=[]}}else{for(var element=scene.getObjectByName("MainMesh",!0),lineSegments=scene.getObjectByProperty("type","LineSegments"),i=0;i<this.highlightedElements.length;i++){this.neighbors.push({vertexInfo:this.highlightedElements[i]/32,edgeColor:{r:0,g:0,b:0}});for(var startEdge=element.geometry.faces[this.highlightedElements[i]].position,j=1;j<element.geometry.faces[this.highlightedElements[i]].neighbors.length;j++){for(var endPoint=32*element.geometry.faces[this.highlightedElements[i]].neighbors[j]+32,k=32*element.geometry.faces[this.highlightedElements[i]].neighbors[j];k<endPoint;k++)element.geometry.faces[k].color.setRGB(1,0,0);clicked.wasClicked=!0;var neighborIndex=32*element.geometry.faces[this.highlightedElements[i]].neighbors[j],endEdge=element.geometry.faces[neighborIndex].position,originalColor={r:0,g:0,b:0};-1!=(index=this.findEdgePairIndex(lineSegments.geometry.vertices,startEdge,endEdge))&&(originalColor.r=lineSegments.geometry.colors[index].r,originalColor.g=lineSegments.geometry.colors[index].g,originalColor.b=lineSegments.geometry.colors[index].b,lineSegments.geometry.colors[index].setRGB(1,0,0)),this.neighbors.push({vertexInfo:element.geometry.faces[this.highlightedElements[i]].neighbors[j],edgeColor:originalColor})}this.highlightedElements.splice(i,1)}element.geometry.colorsNeedUpdate=!0,lineSegments.geometry.colorsNeedUpdate=!0}},EventHandler.prototype.configAndExecuteRaytracing=function(evt,renderer,scene){var canvas=renderer.domElement.getBoundingClientRect(),x=evt.clientX-canvas.left,y=evt.clientY-canvas.top,mouseX=x/renderer.domElement.clientWidth*2-1,mouseY=-y/renderer.domElement.clientHeight*2+1,mouse=new THREE.Vector2(mouseX,mouseY),camera=scene.getObjectByName("camera",!0);return this.raycaster.setFromCamera(mouse,camera),this.raycaster.intersectObjects(scene.children,!0)},EventHandler.prototype.mouseClickEvent=function(evt,renderer,scene){var intersection=this.configAndExecuteRaytracing(evt,renderer,scene)[0];if(void 0!=intersection&&intersection.face){for(var vertices=JSON.parse(intersection.object.geometry.faces[intersection.faceIndex-(intersection.face.a-intersection.face.c)+1].properties),vertexVueHeaders=[],vertexVueRows=[],j=0;void 0!==vertices.vertexes&&j<vertices.vertexes.length;j++){if(0==j){for(key in vertices.vertexes[j])vertexVueHeaders.push(key);vueTableHeader._data.headers=vertexVueHeaders}vertexVueRows.push(vertices.vertexes[j])}vueTableRows._data.rows=vertexVueRows}},EventHandler.prototype.mouseMoveEvent=function(evt,renderer,scene){for(var intersection=this.configAndExecuteRaytracing(evt,renderer,scene)[0],i=0;i<this.highlightedElements.length;i++){for(var endPoint=this.highlightedElements[i]+32,element=scene.getObjectByName("MainMesh",!0),j=this.highlightedElements[i];j<endPoint;j++)element.geometry.faces[j].color.setRGB(0,0,0);element.geometry.colorsNeedUpdate=!0,this.highlightedElements.splice(i,1)}if(void 0!=intersection&&(console.log(intersection),intersection.face)){intersection.face.color.setRGB(0,1,0);for(var endPoint=intersection.faceIndex-(intersection.face.a-intersection.face.c)+1+32,i=intersection.faceIndex-(intersection.face.a-intersection.face.c)+1;i<endPoint;i++)intersection.object.geometry.faces[i].color.setRGB(1,0,0);intersection.object.geometry.colorsNeedUpdate=!0,void 0==this.neighbors.find(function(element){return element.vertexInfo==(intersection.faceIndex-(intersection.face.a-intersection.face.c)+1)/32})&&this.highlightedElements.push(intersection.faceIndex-(intersection.face.a-intersection.face.c)+1)}};var GradientLegend=function(linearScale,minDomainValue,maxDomainValue,width,height,ticks){try{this.spanElementId="spanElementId",this.width=ecmaStandard(width,300),this.height=ecmaStandard(height,50),this.minDomainValue=ecmaStandard(minDomainValue,1),this.maxDomainValue=ecmaStandard(maxDomainValue,5);var defaultLinearScale=d3.scaleLinear().domain([this.minDomainValue,this.maxDomainValue]).range(["rgb(220, 255, 255)","rgb(0, 0, 255)"]);this.linearScale=ecmaStandard(linearScale,defaultLinearScale),this.ticks=ecmaStandard(ticks,5)}catch(err){throw"Unexpected error ocurred at line "+err.lineNumber+", in GradientLegend constructor. "+err}};GradientLegend.prototype.clear=function(){try{d3.select("#"+this.spanElementId).remove(),d3.select("svg").remove()}catch(err){throw"Unexpected error ocurred at line "+err.lineNumber+", in GradientLegend.clear. "+err}},GradientLegend.prototype.createGradientLegend=function(elementId,gradientTitle){try{var span=d3.select("#"+elementId).append("span").attr("id",this.spanElementId).style("padding-right","20px");span._groups[0][0].innerHTML=gradientTitle,console.log(span);var key=d3.select("#"+elementId).append("svg").attr("width",this.width).attr("height",this.height),legend=key.append("defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");legend.append("stop").attr("offset","0%").attr("stop-color","#dcffff").attr("stop-opacity",1),legend.append("stop").attr("offset","100%").attr("stop-color","#0000ff").attr("stop-opacity",1),key.append("rect").attr("width",this.width-5).attr("height",this.height-30).style("fill","url(#gradient)").attr("transform","translate(0,10)");var y=d3.scaleLinear().range([this.width-6,0]).domain([this.maxDomainValue,this.minDomainValue]),yAxis=d3.axisBottom().scale(y).ticks(this.ticks);key.append("g").attr("class","y axis").attr("transform","translate(0,30)").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",0).attr("dy",".71em").style("text-anchor","end").text("axis title")}catch(err){throw"Unexpected error ocurred at line "+err.lineNumber+", in function GradientLegend.createGradientLegend. "+err}},THREE.OrbitControls=function(object,domElement){function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed}function getZoomScale(){return Math.pow(.95,scope.zoomSpeed)}function rotateLeft(angle){sphericalDelta.theta-=angle}function rotateUp(angle){sphericalDelta.phi-=angle}function dollyIn(dollyScale){scope.object.isPerspectiveCamera?scale/=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom*dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function dollyOut(dollyScale){scope.object.isPerspectiveCamera?scale*=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),scope.enableZoom=!1)}function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY)}function handleMouseDownDolly(event){dollyStart.set(event.clientX,event.clientY)}function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY)}function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),dollyDelta.y>0?dollyIn(getZoomScale()):dollyDelta.y<0&&dollyOut(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleMouseUp(event){}function handleMouseWheel(event){event.deltaY<0?dollyOut(getZoomScale()):event.deltaY>0&&dollyIn(getZoomScale()),scope.update()}function handleKeyDown(event){switch(event.keyCode){case scope.keys.UP:pan(0,scope.keyPanSpeed),scope.update();break;case scope.keys.BOTTOM:pan(0,-scope.keyPanSpeed),scope.update();break;case scope.keys.LEFT:pan(scope.keyPanSpeed,0),scope.update();break;case scope.keys.RIGHT:pan(-scope.keyPanSpeed,0),scope.update()}}function handleTouchStartRotate(event){rotateStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchStartDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance)}function handleTouchStartPan(event){panStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchMoveRotate(event){rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleTouchMoveDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance),dollyDelta.subVectors(dollyEnd,dollyStart),dollyDelta.y>0?dollyOut(getZoomScale()):dollyDelta.y<0&&dollyIn(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleTouchMovePan(event){panEnd.set(event.touches[0].pageX,event.touches[0].pageY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleTouchEnd(event){}function onMouseDown(event){if(!1!==scope.enabled){switch(event.preventDefault(),event.button){case scope.mouseButtons.ORBIT:if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE;break;case scope.mouseButtons.ZOOM:if(!1===scope.enableZoom)return;handleMouseDownDolly(event),state=STATE.DOLLY;break;case scope.mouseButtons.PAN:if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN}state!==STATE.NONE&&(document.addEventListener("mousemove",onMouseMove,!1),document.addEventListener("mouseup",onMouseUp,!1),scope.dispatchEvent(startEvent))}}function onMouseMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),state){case STATE.ROTATE:if(!1===scope.enableRotate)return;handleMouseMoveRotate(event);break;case STATE.DOLLY:if(!1===scope.enableZoom)return;handleMouseMoveDolly(event);break;case STATE.PAN:if(!1===scope.enablePan)return;handleMouseMovePan(event)}}function onMouseUp(event){!1!==scope.enabled&&(handleMouseUp(event),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onMouseWheel(event){!1===scope.enabled||!1===scope.enableZoom||state!==STATE.NONE&&state!==STATE.ROTATE||(event.preventDefault(),event.stopPropagation(),handleMouseWheel(event),scope.dispatchEvent(startEvent),scope.dispatchEvent(endEvent))}function onKeyDown(event){!1!==scope.enabled&&!1!==scope.enableKeys&&!1!==scope.enablePan&&handleKeyDown(event)}function onTouchStart(event){if(!1!==scope.enabled){switch(event.touches.length){case 1:if(!1===scope.enableRotate)return;handleTouchStartRotate(event),state=STATE.TOUCH_ROTATE;break;case 2:if(!1===scope.enableZoom)return;handleTouchStartDolly(event),state=STATE.TOUCH_DOLLY;break;case 3:if(!1===scope.enablePan)return;handleTouchStartPan(event),state=STATE.TOUCH_PAN;break;default:state=STATE.NONE}state!==STATE.NONE&&scope.dispatchEvent(startEvent)}}function onTouchMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),event.stopPropagation(),event.touches.length){case 1:if(!1===scope.enableRotate)return;if(state!==STATE.TOUCH_ROTATE)return;handleTouchMoveRotate(event);break;case 2:if(!1===scope.enableZoom)return;if(state!==STATE.TOUCH_DOLLY)return;handleTouchMoveDolly(event);break;case 3:if(!1===scope.enablePan)return;if(state!==STATE.TOUCH_PAN)return;handleTouchMovePan(event);break;default:state=STATE.NONE}}function onTouchEnd(event){!1!==scope.enabled&&(handleTouchEnd(event),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onContextMenu(event){!1!==scope.enabled&&event.preventDefault()}this.object=object,this.domElement=void 0!==domElement?domElement:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return spherical.phi},this.getAzimuthalAngle=function(){return spherical.theta},this.saveState=function(){scope.target0.copy(scope.target),scope.position0.copy(scope.object.position),scope.zoom0=scope.object.zoom},this.reset=function(){scope.target.copy(scope.target0),scope.object.position.copy(scope.position0),scope.object.zoom=scope.zoom0,scope.object.updateProjectionMatrix(),scope.dispatchEvent(changeEvent),scope.update(),state=STATE.NONE},this.update=function(){var offset=new THREE.Vector3,quat=(new THREE.Quaternion).setFromUnitVectors(object.up,new THREE.Vector3(0,1,0)),quatInverse=quat.clone().inverse(),lastPosition=new THREE.Vector3,lastQuaternion=new THREE.Quaternion;return function(){var position=scope.object.position;return offset.copy(position).sub(scope.target),offset.applyQuaternion(quat),spherical.setFromVector3(offset),scope.autoRotate&&state===STATE.NONE&&rotateLeft(getAutoRotationAngle()),spherical.theta+=sphericalDelta.theta,spherical.phi+=sphericalDelta.phi,spherical.theta=Math.max(scope.minAzimuthAngle,Math.min(scope.maxAzimuthAngle,spherical.theta)),spherical.phi=Math.max(scope.minPolarAngle,Math.min(scope.maxPolarAngle,spherical.phi)),spherical.makeSafe(),spherical.radius*=scale,spherical.radius=Math.max(scope.minDistance,Math.min(scope.maxDistance,spherical.radius)),scope.target.add(panOffset),offset.setFromSpherical(spherical),offset.applyQuaternion(quatInverse),position.copy(scope.target).add(offset),scope.object.lookAt(scope.target),!0===scope.enableDamping?(sphericalDelta.theta*=1-scope.dampingFactor,sphericalDelta.phi*=1-scope.dampingFactor):sphericalDelta.set(0,0,0),scale=1,panOffset.set(0,0,0),!!(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS)&&(scope.dispatchEvent(changeEvent),lastPosition.copy(scope.object.position),lastQuaternion.copy(scope.object.quaternion),zoomChanged=!1,cameraPos=scope.object.position.z,!0)}}(),this.dispose=function(){scope.domElement.removeEventListener("contextmenu",onContextMenu,!1),scope.domElement.removeEventListener("mousedown",onMouseDown,!1),scope.domElement.removeEventListener("wheel",onMouseWheel,!1),scope.domElement.removeEventListener("touchstart",onTouchStart,!1),scope.domElement.removeEventListener("touchend",onTouchEnd,!1),scope.domElement.removeEventListener("touchmove",onTouchMove,!1),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1),window.removeEventListener("keydown",onKeyDown,!1)};var scope=this,changeEvent={type:"change"},startEvent={type:"start"},endEvent={type:"end"},STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},state=STATE.NONE,EPS=1e-6,spherical=new THREE.Spherical,sphericalDelta=new THREE.Spherical,scale=1,panOffset=new THREE.Vector3,zoomChanged=!1,rotateStart=new THREE.Vector2,rotateEnd=new THREE.Vector2,rotateDelta=new THREE.Vector2,panStart=new THREE.Vector2,panEnd=new THREE.Vector2,panDelta=new THREE.Vector2,dollyStart=new THREE.Vector2,dollyEnd=new THREE.Vector2,dollyDelta=new THREE.Vector2,panLeft=function(){var v=new THREE.Vector3;return function(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0),v.multiplyScalar(-distance),panOffset.add(v)}}(),panUp=function(){var v=new THREE.Vector3;return function(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,1),v.multiplyScalar(distance),panOffset.add(v)}}(),pan=function(){var offset=new THREE.Vector3;return function(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object.isPerspectiveCamera){var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180),panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix),panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix)}else scope.object.isOrthographicCamera?(panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix),panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),scope.enablePan=!1)}}();$("#zoomIn").on("click",function(){dollyOut(getZoomScale()),scope.update()}),$("#zoomOut").on("click",function(){dollyIn(getZoomScale()),scope.update()}),$("#panLeft").on("click",function(){scope.reset(),parseInt(bipartiteGraph.firstLayer)>parseInt(bipartiteGraph.lastLayer)?panSize=parseInt(bipartiteGraph.firstLayer):panSize=parseInt(bipartiteGraph.lastLayer),pan(2*panSize,0),scope.update()}),$("#panRight").on("click",function(){scope.reset(),parseInt(bipartiteGraph.firstLayer)>parseInt(bipartiteGraph.lastLayer)?panSize=parseInt(bipartiteGraph.firstLayer):panSize=parseInt(bipartiteGraph.lastLayer),pan(2*-panSize,0),scope.update()}),$("#resetButton").on("click",function(){scope.reset(),scope.object.position.z=document.getElementById("mainSection").clientHeight/4,scope.update()}),scope.domElement.addEventListener("contextmenu",onContextMenu,!1),scope.domElement.addEventListener("mousedown",onMouseDown,!1),scope.domElement.addEventListener("wheel",onMouseWheel,!1),scope.domElement.addEventListener("touchstart",onTouchStart,!1),scope.domElement.addEventListener("touchend",onTouchEnd,!1),scope.domElement.addEventListener("touchmove",onTouchMove,!1),window.addEventListener("keydown",onKeyDown,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(value){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!value}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(value){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!value}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(value){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!value}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(value){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!value}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(value){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!value}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(value){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=value}}});